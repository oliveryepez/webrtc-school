<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0029)http://tools.ietf.org/rfcdiff -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
   
  <meta http-equiv="Content-Style-Type" content="text/css"> 
  <title>Diff: data-game.html - data-game-solution.html</title> 
  <style type="text/css"> 
    body    { margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body> 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tbody><tr bgcolor="orange"><th></th><th>&nbsp;data-game.html&nbsp;</th><th> </th><th>&nbsp;data-game-solution.html&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray"><td></td><th><a name="part-l1"><small>skipping to change at</small><em> line 273</em></a></th><th> </th><th><a name="part-r1"><small>skipping to change at</small><em> line 273</em></a></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// When our browser detects that the other side has added the</td><td> </td><td class="right">// When our browser detects that the other side has added the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// data channel, save it, set up handlers, and send welcome</td><td> </td><td class="right">// data channel, save it, set up handlers, and send welcome</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// message</td><td> </td><td class="right">// message</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">function onDataChannelAdded(e) {</td><td> </td><td class="right">function onDataChannelAdded(e) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  console.log("Data channel id is " + e.channel.id + " label is " + e.channel.label);</td><td> </td><td class="right">  console.log("Data channel id is " + e.channel.id + " label is " + e.channel.label);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (e.channel.label == "chat") {</td><td> </td><td class="right">  if (e.channel.label == "chat") {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  	dc = e.channel;</td><td> </td><td class="right">  	dc = e.channel;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  	setupDataHandlers();</td><td> </td><td class="right">  	setupDataHandlers();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  	sendChat("hello");</td><td> </td><td class="right">  	sendChat("hello");</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001"></a></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">  <span class="insert">} else if (e.channel.label == "game") {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  	dc2 = e.channel;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  	setupDataHandlers2();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  } else {</td><td> </td><td class="right">  } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  	console.log("Unknown data channel added.");</td><td> </td><td class="right">  	console.log("Unknown data channel added.");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Set up the data channel message handler</td><td> </td><td class="right">// Set up the data channel message handler</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">function setupDataHandlers() {</td><td> </td><td class="right">function setupDataHandlers() {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  data.send = function(msg) {</td><td> </td><td class="right">  data.send = function(msg) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    msg = JSON.stringify(msg);</td><td> </td><td class="right">    msg = JSON.stringify(msg);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    console.log("sending " + msg + " over data channel");</td><td> </td><td class="right">    console.log("sending " + msg + " over data channel");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray"><td></td><th><a name="part-l2"><small>skipping to change at</small><em> line 454</em></a></th><th> </th><th><a name="part-r2"><small>skipping to change at</small><em> line 457</em></a></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      gameE.style.display = "inline";</td><td> </td><td class="right">      gameE.style.display = "inline";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      break;</td><td> </td><td class="right">      break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    default:</td><td> </td><td class="right">    default:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">function getMouseCoords(e) {</td><td> </td><td class="right">function getMouseCoords(e) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    var x = e.clientX;</td><td> </td><td class="right">    var x = e.clientX;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    var y = e.clientY;</td><td> </td><td class="right">    var y = e.clientY;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    var coords = {"x":x, "y":y};</td><td> </td><td class="right">    var coords = {"x":x, "y":y};</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002"></a></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">    <span class="insert">msg = JSON.stringify(coords);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    console.log("sending " + msg + " over data channel 2");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    dc2.send(msg);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    displayCoords(coords, "#FF0000");	// display dot in red</td><td> </td><td class="right">    displayCoords(coords, "#FF0000");	// display dot in red</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">function displayCoords(coords, color) {</td><td> </td><td class="right">function displayCoords(coords, color) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//	console.info(coords);</td><td> </td><td class="right">//	console.info(coords);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">	ctx.fillStyle = color;</td><td> </td><td class="right">	ctx.fillStyle = color;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">	ctx.fillRect(coords.x,coords.y,3,3);</td><td> </td><td class="right">	ctx.fillRect(coords.x,coords.y,3,3);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">function game() {</td><td> </td><td class="right">function game() {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003"></a></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">gameStart();</span></td><td> </td><td class="rblock">    <span class="insert">dc2 = pc.createDataChannel('game');</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    setupDataHandlers2();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    console.log("Creating data channel 2");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">function gameStart() {</td><td> </td><td class="right">function gameStart() {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    canvasE = document.getElementById("canvas");</td><td> </td><td class="right">    canvasE = document.getElementById("canvas");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    canvasE.style.display = "inline";</td><td> </td><td class="right">    canvasE.style.display = "inline";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    console.log("Game Started!");</td><td> </td><td class="right">    console.log("Game Started!");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    ctx.fillText("Draw Here!", 10, 10);</td><td> </td><td class="right">    ctx.fillText("Draw Here!", 10, 10);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004"></a></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// Set up the data channel message handler</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">function setupDataHandlers2() {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  dc2.onmessage = function(e) {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    var coords = JSON.parse(e.data);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    console.log("received " + e.data + " on data channel 2");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    displayCoords(coords, "#0000FF");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  dc2.onerror = function(e) {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  	console.log("Data Channel error 2");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  	console.info(e);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  dc2.onopen = function(e) {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    console.log("Data channel 2 established!");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    gameStart();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  };</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">&lt;/script&gt;</td><td> </td><td class="right">&lt;/script&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">&lt;div id="setup"&gt;</td><td> </td><td class="right">&lt;div id="setup"&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  &lt;canvas id="canvas" width="300" height="300" onmousemove="getMouseCoords(event)"</td><td> </td><td class="right">  &lt;canvas id="canvas" width="300" height="300" onmousemove="getMouseCoords(event)"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  			border="2" style="display:none"&gt;</td><td> </td><td class="right">  			border="2" style="display:none"&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  &lt;/canvas&gt;</td><td> </td><td class="right">  &lt;/canvas&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  &lt;p&gt;WebRTC Book Demo with Game&lt;/p&gt;</td><td> </td><td class="right">  &lt;p&gt;WebRTC Book Demo with Game&lt;/p&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  &lt;p&gt;Key:</td><td> </td><td class="right">  &lt;p&gt;Key:</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 4 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>1 lines changed or deleted</i></th><th><i> </i></th><th><i>26 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br>This html diff was produced by rfcdiff 1.42. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/">http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </tbody></table>
   
   
X-Generator: pyht 0.35

<!-- args: {'--oldcolour': 'red', '--width': '', 'difftype': '--html', 'filename2': '__--\n// Copyright 2013-2015 Digital Codex LLC\n// You may use this code for your own education.  If you use it\n// largely intact, or develop something from it, don\'t claim that\n// your code came first.  You are using this code completely at\n// your own risk.  If you rely on it to work in any particular\n// way, you\'re an idiot and we won\'t be held responsible.\n--_\n\n_html_\n_head_\n  _meta http-equiv="Content-Type"\n        content="text/html; charset=UTF-8" /_\n  _style_\n    video {\n      width:  320px;\n      height:  240px;\n      border:  1px solid black;\n    }\n    div {\n      display:  inline-block;\n    }\n    canvas {\n      border:  1px solid black;\n    }\n  _/style_\n_/head_\n_body_\n\n__-- blank script section is placeholder for query params --_\n_script__/script_\n\n__-- load polyfill, local copy first for local testing --_\n_script src="extra/adapter.js" type="text/javascript"__/script_\n_script\n  src="https://webrtc.github.io/adapter/adapter.js"\n  type="text/javascript"__/script_\n\n__-- load XHR-based signaling channel that direct connects based\n     on a key --_\n_script src="clientXHRSignalingChannel.js"\n        type="text/javascript"__/script_\n\n_script_\nvar signalingChannel, key, id,\n    haveLocalMedia = false,\n    weWaited = false,\n    myVideoStream, myVideo, \n    yourVideoStream, yourVideo,\n    doNothing = function() {},\n    pc, dc, data = {},\n    dc2, c, ctx,\n    constraints = {mandatory: {\n                    OfferToReceiveAudio: true,\n                    OfferToReceiveVideo: true}};\n\n////////////////////////////\n// This is the main routine.\n////////////////////////////\n\n// This kicks off acquisition of local media.  Also, it can\n// automatically start the signaling channel.\nwindow.onload = function () {\n\n  // auto-connect signaling channel if key provided in URI\n  if (queryparams __ queryparams[\'key\']) {\n    document.getElementById("key").value = queryparams[\'key\'];\n    connect();\n  }\n\n  c = document.getElementById("canvas");\n  ctx = c.getContext("2d");\n  ctx.font = "10px Courier";\n\n  myVideo = document.getElementById("myVideo");\n  yourVideo = document.getElementById("yourVideo");\n  \n  getMedia();\n\n  //  connect() calls createPC() when connected.\n  //  attachMedia() is called when both createPC() and getMedia()\n  //  have succeeded.\n};\n\n\n/////////////////////\n// This next section is for setting up the signaling channel.\n/////////////////////\n\n// This routine connects to the web server and sets up the\n// signaling channel.  It is called either automatically on doc\n// load or when the user clicks on the "Connect" button.\nfunction connect() {\n  var errorCB, scHandlers, handleMsg;\n\n  // First, get the key used to connect\n  key = document.getElementById("key").value;\n\n  // This is the handler for all messages received on the\n  // signaling channel.\n  handleMsg = function (msg) {\n    // First, we clean up the message and post it on-screen\n    var msgE = document.getElementById("inmessages");\n    var msgString = JSON.stringify(msg).replace(/\\\\r\\\\n/g,\'\\n\');\n    msgE.value = msgString + "\\n" + msgE.value;\n    \n    // Then, we take action based on the kind of message\n    if (msg.type === "offer") {\n      pc.setRemoteDescription(new RTCSessionDescription(msg));\n      answer();\n    } else if (msg.type === "answer") {\n      pc.setRemoteDescription(new RTCSessionDescription(msg));\n    } else if (msg.type === "candidate") {\n      pc.addIceCandidate(\n        new RTCIceCandidate({sdpMLineIndex:msg.mlineindex,\n                             candidate:msg.candidate}));\n    }\n  };\n\n  // handlers for signaling channel\n  scHandlers = {\n    \'onWaiting\' : function () {\n      setStatus("Waiting");\n      // weWaited will be used later for auto-call\n      weWaited = true;\n    },\n    \'onConnected\': function () {\n      setStatus("Connected");\n      // set up the RTC Peer Connection since we\'re connected\n      createPC();\n    },\n    \'onMessage\': handleMsg\n  };\n\n  // Finally, create signaling channel\n  signalingChannel = createSignalingChannel(key, scHandlers);\n  errorCB = function (msg) {\n    document.getElementById("response").innerHTML = msg;\n  };\n\n  // and connect.\n  signalingChannel.connect(errorCB);\n}\n\n\n// This routine sends a message on the signaling channel, either\n// by explicit call or by the user clicking on the Send button.\nfunction send(msg) {\n  var handler = function (res) {\n    document.getElementById("response").innerHTML = res;\n    return;\n  },\n\n  // Get message if not passed in\n  msg = msg __ document.getElementById("message").value;\n\n  // Clean it up and post it on-screen\n  msgE = document.getElementById("outmessages");\n  var msgString = JSON.stringify(msg).replace(/\\\\r\\\\n/g,\'\\n\');\n  msgE.value = msgString + "\\n" + msgE.value;\n\n  // and send on signaling channel\n  signalingChannel.send(msg, handler);\n}\n\n\n/////////////////////////////\n// This next section is for getting local media\n/////////////////////////////\n\nfunction getMedia() {\n  getUserMedia({"audio":true, "video":true},\n               gotUserMedia, didntGetUserMedia);\n}\n\nfunction gotUserMedia(stream) {\n  myVideoStream = stream;\n  haveLocalMedia = true;\n\n  // display my local video to me\n  attachMediaStream(myVideo, myVideoStream);\n  // wait for RTCPeerConnection to be created\n  attachMediaIfReady();\n}\n\nfunction didntGetUserMedia() {\n  console.log("couldn\'t get video");\n}\n\n//////////////////////////////\n// This next section is for setting up the RTC Peer Connection\n//////////////////////////////\n\nfunction createPC() {\n  var stunuri = true,\n      turnuri = false,\n      myfalse = function(v) {\n                  return ((v==="0")__(v==="false")__(_v)); },\n      config = new Array();\n\n  // adjust config string based on any query params\n  if (queryparams) {\n    if (\'stunuri\' in queryparams) {\n      stunuri = _myfalse(queryparams[\'stunuri\']);\n    }\n    if (\'turnuri\' in queryparams) {\n      turnuri = _myfalse(queryparams[\'turnuri\']);\n    };\n  };\n\n  if (stunuri) {\n    // this is one of Google\'s public STUN servers\n    config.push({"url":"stun:stun.l.google.com:19302",\n                 "urls":"stun:stun.l.google.com:19302"});\n  }\n  if (turnuri) {\n    if (stunuri) {\n      // can\'t use TURN-only TURN server in this case because of\n      // bug in Chrome that causes STUN server responses to be\n      // ignored, so we use TURN server that also does STUN\n      config.push({"url":"turn:user@turn.webrtcbook.com",\n                   "urls":"turn:turn.webrtcbook.com",\n                   "username":"user",\n                   "credential":"test"});\n    } else {\n      // this is our TURN-only TURN server\n      config.push({"url":"turn:user@turn-only.webrtcbook.com",\n                   "urls":"turn:turn-only.webrtcbook.com",\n                   "username":"user",\n                   "credential":"test"});\n    }\n  }\n  console.log("config = " + JSON.stringify(config));\n\n  pc = new RTCPeerConnection({iceServers:config});\n  pc.onicecandidate = onIceCandidate;\n  pc.onaddstream = onRemoteStreamAdded;\n  pc.onremovestream = onRemoteStreamRemoved;\n  pc.ondatachannel = onDataChannelAdded;\n\n  // wait for local media to be ready\n  attachMediaIfReady();\n}\n\n// When our browser has another candidate, send it to the peer\nfunction onIceCandidate(e) {\n  if (e.candidate) {\n    send({type:  \'candidate\',\n          mlineindex:  e.candidate.sdpMLineIndex,\n          candidate:  e.candidate.candidate});\n  }\n}\n\n// When our browser detects that the other side has added the\n// media stream, show it on screen\nfunction onRemoteStreamAdded(e) {\n  yourVideoStream = e.stream;\n  attachMediaStream(yourVideo, yourVideoStream);\n  setStatus("On call");\n}\n\n// Yes, we do nothing if the remote side removes the stream.\n// This is a *simple* demo, after all.\nfunction onRemoteStreamRemoved(e) {}\n\n// When our browser detects that the other side has added the\n// data channel, save it, set up handlers, and send welcome\n// message\nfunction onDataChannelAdded(e) {\n\n  console.log("Data channel id is " + e.channel.id + " label is " + e.channel.label);\n  if (e.channel.label == "chat") {\n  \tdc = e.channel;\n  \tsetupDataHandlers();\n  \tsendChat("hello");\n  } else if (e.channel.label == "game") {\n  \tdc2 = e.channel;\n  \tsetupDataHandlers2();  \n  } else {\n  \tconsole.log("Unknown data channel added.");\n  }\t\n}\n\n// Set up the data channel message handler\nfunction setupDataHandlers() {\n  data.send = function(msg) {\n    msg = JSON.stringify(msg);\n    console.log("sending " + msg + " over data channel");\n    dc.send(msg);\n  }\n  dc.onmessage = function(e) {\n    var msg = JSON.parse(e.data),\n        cb = document.getElementById("chatbox"),\n        rtt = document.getElementById("rtt");\n    \n    if (msg.rtt) {\n      // if real-time-text (per keypress) message, display in\n      // real-time window\n      console.log("received rtt of \'" + msg.rtt + "\'");\n      rtt.value = msg.rtt;\n      msg = msg.rtt;\n    } else if (msg.chat) {\n      // if full message, display in chat window,\n      // reset real-time window,\n      // and force chat window to last line\n      console.log("received chat of \'" + msg.chat + "\'");\n      cb.value += "_- " + msg.chat + "\\n";\n      rtt.value = "";\n      cb.scrollTop = cb.scrollHeight;\n      msg = msg.chat;\n    } else {\n      console.log("received " + msg + "on data channel");\n    }\n  }\n  dc.onerror = function(e) {\n  \tconsole.log("Data channel error.");\n  \tconsole.info(e);\n  }\n  dc.onopen = function(e) {\n    console.log("Data channel created.");\n  };\n}\n\n// Send real-time text.  Basically for every keyup event we send\n// the entire string so far as a real-time message so it can be\n// displayed at each keyup.\nfunction sendRtt() {\n  var msg = document.getElementById("chat").value;\n  data.send({\'rtt\':msg});\n}\n\n// Send normal chat message.  This happens when there is an enter\n// keyup event, meaning that the remote user has finished typing\n// a line.  This is also used to send our initial hello message.\nfunction sendChat(msg) {\n  var cb = document.getElementById("chatbox"),\n      c = document.getElementById("chat");\n\n  // display message locally, send it, and force chat window to\n  // last line\n  msg = msg __ c.value;\n  console.log("sendChat(" + msg + ")");\n  cb.value += "-_ " + msg + "\\n";\n  data.send({\'chat\':msg});\n  c.value = \'\';\n  cb.scrollTop = cb.scrollHeight;\n}\n\n\n///////////////////////////////////\n// This next section is for attaching local media to the Peer\n// Connection.\n///////////////////////////////////\n\n// This guard routine effectively synchronizes completion of two\n// async activities:  the creation of the Peer Connection and\n// acquisition of local media.\nfunction attachMediaIfReady() {\n  // If RTCPeerConnection is ready and we have local media,\n  // proceed.\n  if (pc __ haveLocalMedia) {attachMedia();}\n}\n\n// This routine adds our local media stream to the Peer\n// Connection.  Note that this does not cause any media to flow.\n// All it does is to let the browser know to include this stream\n// in its next SDP description.\nfunction attachMedia() {\n  pc.addStream(myVideoStream);\n  setStatus("Ready for call");\n\n  // auto-call if truthy value for call param in URI\n  // but also make sure we were the last to connect (to increase\n  // chances that everything is set up properly at both ends)\n  if (queryparams __ queryparams[\'call\'] __ _weWaited) {\n    call();\n  }\n\n}\n\n\n////////////////////////////\n// This next section is for calling and answering\n////////////////////////////\n\n// This creates a data channel and generates the\n// session description for an offer\nfunction call() {\n  dc = pc.createDataChannel(\'chat\');\n  setupDataHandlers();\n  \n  pc.createOffer(gotDescription, doNothing, constraints);\n}\n\n// and this generates it for an answer.\nfunction answer() {\n  pc.createAnswer(gotDescription, doNothing, constraints);\n}\n\n// In either case, once we get the session description we tell\n// our browser to use it as our local description and then send\n// it to the other browser.  It is the setting of the local\n// description that allows the browser to send media and prepare\n// to receive from the other side.\nfunction gotDescription(localDesc) {\n  pc.setLocalDescription(localDesc);\n  send(localDesc);\n}\n\n\n////////////////////////////////////\n// This section is for changing the UI based on application\n// progress.\n////////////////////////////////////\n\n// This function hides, displays, and fills various UI elements\n// to give the user some idea of how the browser is progressing\n// at setting up the signaling channel, getting local media,\n// creating the peer connection, and actually connecting\n// media (calling).\nfunction setStatus(str) {\n  var statuslineE = document.getElementById("statusline"),\n      statusE = document.getElementById("status"),\n      sendE = document.getElementById("send"),\n      connectE = document.getElementById("connect"),\n      callE = document.getElementById("call"),\n      scMessageE = document.getElementById("scMessage");\n      gameE = document.getElementById("game");\n      \n  switch (str) {\n    case \'Waiting\':\n      statuslineE.style.display = "inline";\n      statusE.innerHTML =\n        "Waiting for peer signaling connection";\n      sendE.style.display = "none";\n      connectE.style.display = "none";\n      break;\n    case \'Connected\':\n      statuslineE.style.display = "inline";\n      statusE.innerHTML =\n        "Peer signaling connected, waiting for local media";\n      sendE.style.display = "inline";\n      connectE.style.display = "none";\n      scMessageE.style.display = "inline-block";\n      break;\n    case \'Ready for call\':\n      statusE.innerHTML = "Ready for call";\n      callE.style.display = "inline";\n      break;\n    case \'On call\':\n      statusE.innerHTML = "On call";\n      callE.style.display = "none";\n      gameE.style.display = "inline";\n      break;\n    default:\n  }\n}\n\nfunction getMouseCoords(e) {\n    var x = e.clientX;\n    var y = e.clientY;\n    var coords = {"x":x, "y":y};    \n    msg = JSON.stringify(coords);\n    console.log("sending " + msg + " over data channel 2");\n    dc2.send(msg);\n    \n    displayCoords(coords, "#FF0000");\t// display dot in red    \n}\n\nfunction displayCoords(coords, color) {\n//\tconsole.info(coords);\n\tctx.fillStyle = color;  \n\tctx.fillRect(coords.x,coords.y,3,3);\n}\n\nfunction game() {\n    dc2 = pc.createDataChannel(\'game\');\n    setupDataHandlers2();\n    console.log("Creating data channel 2");   \n}\n\nfunction gameStart() {\n    canvasE = document.getElementById("canvas");\n    canvasE.style.display = "inline";\n    console.log("Game Started_");\n    ctx.fillText("Draw Here_", 10, 10);\n}\n\n// Set up the data channel message handler\nfunction setupDataHandlers2() {\n  dc2.onmessage = function(e) {\n    var coords = JSON.parse(e.data);\n    console.log("received " + e.data + " on data channel 2");\n    displayCoords(coords, "#0000FF");\n  }\n  dc2.onerror = function(e) {\n  \tconsole.log("Data Channel error 2");\n  \tconsole.info(e);\n  }\n  dc2.onopen = function(e) {\n    console.log("Data channel 2 established_");\n    gameStart();\n  };\n}\n\n_/script_\n\n_div id="setup"_\n\n  _canvas id="canvas" width="300" height="300" onmousemove="getMouseCoords(event)" \n  \t\t\tborder="2" style="display:none"_ \n  _/canvas_\n\n  _p_WebRTC Book Demo with Game_/p_\n  _p_Key:\n    _input type="text" name="key" id="key"\n           onkeyup="if (event.keyCode == 13) {\n                      connect(); return false;}"/_\n    _button id="connect" onclick="connect()"_Connect_/button_\n    _span id="statusline" style="display:none"_Status:\n      _span id="status"_Disconnected_/span_\n    _/span_\n    _button id="call" style="display:none"\n            onclick = "call()"_Call_/button_\n    _button id="game" style="display:none"\n            onclick = "game()"_Game_/button_        \n  _/p_\n_/div_\n\n_div id="scMessage" style="float:right;display:none"_\n  _p_Signaling channel message:\n    _input type="text" width="100_" name="message" id="message"\n           onkeyup="if (event.keyCode == 13) {\n                      send(); return false;}"/_\n    _button id="send" style="display:none"\n            onclick="send()"_Send_/button_\n  _/p_\n\n  _p_Response:  _span id="response"__/span__/p_\n_/div_\n\n_br/_\n\n_div style="width:30_;vertical-align:top"_\n  _div_\n    _video id="myVideo" autoplay="autoplay" controls\n           muted="true"/_\n  _/div_\n  _p__b_Outgoing Messages_/b_\n     _br/_\n     _textarea id="outmessages" rows="100"\n               style="width:100_"__/textarea_\n  _/p_\n_/div_\n\n_div style="width:30_;vertical-align:top"_\n  _textarea id="chatbox" rows="10" style="width:100_"__/textarea_\n  _p style="width:100_"__b_Real-time:_/b_\n    _textarea id="rtt" rows="2" style="width:100_"__/textarea_\n  _/p_\n  _p style="width:100_"__b_Chat message:_/b_\n    _input type="text" style="width:100_" name="chat" id="chat"\n           onkeyup="sendRtt();\n                    if (event.keyCode == 13) {\n                      sendChat(); return false;}"/_\n  _/p_\n\n\n_/div_\n\n_div style="width:30_;vertical-align:top"_\n  _div_\n    _video id="yourVideo" autoplay="autoplay" controls /_\n  _/div_\n  _p__b_Incoming Messages_/b_\n     _br/_\n     _textarea id="inmessages" rows="100"\n               style="width:100_"__/textarea_\n  _/p_\n_/div_\n\n\n\n\n\n_/body_\n_/html_\n', 'filename1': '__--\n// Copyright 2013-2015 Digital Codex LLC\n// You may use this code for your own education.  If you use it\n// largely intact, or develop something from it, don\'t claim that\n// your code came first.  You are using this code completely at\n// your own risk.  If you rely on it to work in any particular\n// way, you\'re an idiot and we won\'t be held responsible.\n--_\n\n_html_\n_head_\n  _meta http-equiv="Content-Type"\n        content="text/html; charset=UTF-8" /_\n  _style_\n    video {\n      width:  320px;\n      height:  240px;\n      border:  1px solid black;\n    }\n    div {\n      display:  inline-block;\n    }\n    canvas {\n      border:  1px solid black;\n    }\n  _/style_\n_/head_\n_body_\n\n__-- blank script section is placeholder for query params --_\n_script__/script_\n\n__-- load polyfill, local copy first for local testing --_\n_script src="extra/adapter.js" type="text/javascript"__/script_\n_script\n  src="https://webrtc.github.io/adapter/adapter.js"\n  type="text/javascript"__/script_\n\n__-- load XHR-based signaling channel that direct connects based\n     on a key --_\n_script src="clientXHRSignalingChannel.js"\n        type="text/javascript"__/script_\n\n_script_\nvar signalingChannel, key, id,\n    haveLocalMedia = false,\n    weWaited = false,\n    myVideoStream, myVideo, \n    yourVideoStream, yourVideo,\n    doNothing = function() {},\n    pc, dc, data = {},\n    dc2, c, ctx,\n    constraints = {mandatory: {\n                    OfferToReceiveAudio: true,\n                    OfferToReceiveVideo: true}};\n\n////////////////////////////\n// This is the main routine.\n////////////////////////////\n\n// This kicks off acquisition of local media.  Also, it can\n// automatically start the signaling channel.\nwindow.onload = function () {\n\n  // auto-connect signaling channel if key provided in URI\n  if (queryparams __ queryparams[\'key\']) {\n    document.getElementById("key").value = queryparams[\'key\'];\n    connect();\n  }\n\n  c = document.getElementById("canvas");\n  ctx = c.getContext("2d");\n  ctx.font = "10px Courier";\n\n  myVideo = document.getElementById("myVideo");\n  yourVideo = document.getElementById("yourVideo");\n  \n  getMedia();\n\n  //  connect() calls createPC() when connected.\n  //  attachMedia() is called when both createPC() and getMedia()\n  //  have succeeded.\n};\n\n\n/////////////////////\n// This next section is for setting up the signaling channel.\n/////////////////////\n\n// This routine connects to the web server and sets up the\n// signaling channel.  It is called either automatically on doc\n// load or when the user clicks on the "Connect" button.\nfunction connect() {\n  var errorCB, scHandlers, handleMsg;\n\n  // First, get the key used to connect\n  key = document.getElementById("key").value;\n\n  // This is the handler for all messages received on the\n  // signaling channel.\n  handleMsg = function (msg) {\n    // First, we clean up the message and post it on-screen\n    var msgE = document.getElementById("inmessages");\n    var msgString = JSON.stringify(msg).replace(/\\\\r\\\\n/g,\'\\n\');\n    msgE.value = msgString + "\\n" + msgE.value;\n    \n    // Then, we take action based on the kind of message\n    if (msg.type === "offer") {\n      pc.setRemoteDescription(new RTCSessionDescription(msg));\n      answer();\n    } else if (msg.type === "answer") {\n      pc.setRemoteDescription(new RTCSessionDescription(msg));\n    } else if (msg.type === "candidate") {\n      pc.addIceCandidate(\n        new RTCIceCandidate({sdpMLineIndex:msg.mlineindex,\n                             candidate:msg.candidate}));\n    }\n  };\n\n  // handlers for signaling channel\n  scHandlers = {\n    \'onWaiting\' : function () {\n      setStatus("Waiting");\n      // weWaited will be used later for auto-call\n      weWaited = true;\n    },\n    \'onConnected\': function () {\n      setStatus("Connected");\n      // set up the RTC Peer Connection since we\'re connected\n      createPC();\n    },\n    \'onMessage\': handleMsg\n  };\n\n  // Finally, create signaling channel\n  signalingChannel = createSignalingChannel(key, scHandlers);\n  errorCB = function (msg) {\n    document.getElementById("response").innerHTML = msg;\n  };\n\n  // and connect.\n  signalingChannel.connect(errorCB);\n}\n\n\n// This routine sends a message on the signaling channel, either\n// by explicit call or by the user clicking on the Send button.\nfunction send(msg) {\n  var handler = function (res) {\n    document.getElementById("response").innerHTML = res;\n    return;\n  },\n\n  // Get message if not passed in\n  msg = msg __ document.getElementById("message").value;\n\n  // Clean it up and post it on-screen\n  msgE = document.getElementById("outmessages");\n  var msgString = JSON.stringify(msg).replace(/\\\\r\\\\n/g,\'\\n\');\n  msgE.value = msgString + "\\n" + msgE.value;\n\n  // and send on signaling channel\n  signalingChannel.send(msg, handler);\n}\n\n\n/////////////////////////////\n// This next section is for getting local media\n/////////////////////////////\n\nfunction getMedia() {\n  getUserMedia({"audio":true, "video":true},\n               gotUserMedia, didntGetUserMedia);\n}\n\nfunction gotUserMedia(stream) {\n  myVideoStream = stream;\n  haveLocalMedia = true;\n\n  // display my local video to me\n  attachMediaStream(myVideo, myVideoStream);\n  // wait for RTCPeerConnection to be created\n  attachMediaIfReady();\n}\n\nfunction didntGetUserMedia() {\n  console.log("couldn\'t get video");\n}\n\n//////////////////////////////\n// This next section is for setting up the RTC Peer Connection\n//////////////////////////////\n\nfunction createPC() {\n  var stunuri = true,\n      turnuri = false,\n      myfalse = function(v) {\n                  return ((v==="0")__(v==="false")__(_v)); },\n      config = new Array();\n\n  // adjust config string based on any query params\n  if (queryparams) {\n    if (\'stunuri\' in queryparams) {\n      stunuri = _myfalse(queryparams[\'stunuri\']);\n    }\n    if (\'turnuri\' in queryparams) {\n      turnuri = _myfalse(queryparams[\'turnuri\']);\n    };\n  };\n\n  if (stunuri) {\n    // this is one of Google\'s public STUN servers\n    config.push({"url":"stun:stun.l.google.com:19302",\n                 "urls":"stun:stun.l.google.com:19302"});\n  }\n  if (turnuri) {\n    if (stunuri) {\n      // can\'t use TURN-only TURN server in this case because of\n      // bug in Chrome that causes STUN server responses to be\n      // ignored, so we use TURN server that also does STUN\n      config.push({"url":"turn:user@turn.webrtcbook.com",\n                   "urls":"turn:turn.webrtcbook.com",\n                   "username":"user",\n                   "credential":"test"});\n    } else {\n      // this is our TURN-only TURN server\n      config.push({"url":"turn:user@turn-only.webrtcbook.com",\n                   "urls":"turn:turn-only.webrtcbook.com",\n                   "username":"user",\n                   "credential":"test"});\n    }\n  }\n  console.log("config = " + JSON.stringify(config));\n\n  pc = new RTCPeerConnection({iceServers:config});\n  pc.onicecandidate = onIceCandidate;\n  pc.onaddstream = onRemoteStreamAdded;\n  pc.onremovestream = onRemoteStreamRemoved;\n  pc.ondatachannel = onDataChannelAdded;\n\n  // wait for local media to be ready\n  attachMediaIfReady();\n}\n\n// When our browser has another candidate, send it to the peer\nfunction onIceCandidate(e) {\n  if (e.candidate) {\n    send({type:  \'candidate\',\n          mlineindex:  e.candidate.sdpMLineIndex,\n          candidate:  e.candidate.candidate});\n  }\n}\n\n// When our browser detects that the other side has added the\n// media stream, show it on screen\nfunction onRemoteStreamAdded(e) {\n  yourVideoStream = e.stream;\n  attachMediaStream(yourVideo, yourVideoStream);\n  setStatus("On call");\n}\n\n// Yes, we do nothing if the remote side removes the stream.\n// This is a *simple* demo, after all.\nfunction onRemoteStreamRemoved(e) {}\n\n// When our browser detects that the other side has added the\n// data channel, save it, set up handlers, and send welcome\n// message\nfunction onDataChannelAdded(e) {\n\n  console.log("Data channel id is " + e.channel.id + " label is " + e.channel.label);\n  if (e.channel.label == "chat") {\n  \tdc = e.channel;\n  \tsetupDataHandlers();\n  \tsendChat("hello");\n  } else {\n  \tconsole.log("Unknown data channel added.");\n  }\t\n}\n\n// Set up the data channel message handler\nfunction setupDataHandlers() {\n  data.send = function(msg) {\n    msg = JSON.stringify(msg);\n    console.log("sending " + msg + " over data channel");\n    dc.send(msg);\n  }\n  dc.onmessage = function(e) {\n    var msg = JSON.parse(e.data),\n        cb = document.getElementById("chatbox"),\n        rtt = document.getElementById("rtt");\n    \n    if (msg.rtt) {\n      // if real-time-text (per keypress) message, display in\n      // real-time window\n      console.log("received rtt of \'" + msg.rtt + "\'");\n      rtt.value = msg.rtt;\n      msg = msg.rtt;\n    } else if (msg.chat) {\n      // if full message, display in chat window,\n      // reset real-time window,\n      // and force chat window to last line\n      console.log("received chat of \'" + msg.chat + "\'");\n      cb.value += "_- " + msg.chat + "\\n";\n      rtt.value = "";\n      cb.scrollTop = cb.scrollHeight;\n      msg = msg.chat;\n    } else {\n      console.log("received " + msg + "on data channel");\n    }\n  }\n  dc.onerror = function(e) {\n  \tconsole.log("Data channel error.");\n  \tconsole.info(e);\n  }\n  dc.onopen = function(e) {\n    console.log("Data channel created.");\n  };\n}\n\n// Send real-time text.  Basically for every keyup event we send\n// the entire string so far as a real-time message so it can be\n// displayed at each keyup.\nfunction sendRtt() {\n  var msg = document.getElementById("chat").value;\n  data.send({\'rtt\':msg});\n}\n\n// Send normal chat message.  This happens when there is an enter\n// keyup event, meaning that the remote user has finished typing\n// a line.  This is also used to send our initial hello message.\nfunction sendChat(msg) {\n  var cb = document.getElementById("chatbox"),\n      c = document.getElementById("chat");\n\n  // display message locally, send it, and force chat window to\n  // last line\n  msg = msg __ c.value;\n  console.log("sendChat(" + msg + ")");\n  cb.value += "-_ " + msg + "\\n";\n  data.send({\'chat\':msg});\n  c.value = \'\';\n  cb.scrollTop = cb.scrollHeight;\n}\n\n\n///////////////////////////////////\n// This next section is for attaching local media to the Peer\n// Connection.\n///////////////////////////////////\n\n// This guard routine effectively synchronizes completion of two\n// async activities:  the creation of the Peer Connection and\n// acquisition of local media.\nfunction attachMediaIfReady() {\n  // If RTCPeerConnection is ready and we have local media,\n  // proceed.\n  if (pc __ haveLocalMedia) {attachMedia();}\n}\n\n// This routine adds our local media stream to the Peer\n// Connection.  Note that this does not cause any media to flow.\n// All it does is to let the browser know to include this stream\n// in its next SDP description.\nfunction attachMedia() {\n  pc.addStream(myVideoStream);\n  setStatus("Ready for call");\n\n  // auto-call if truthy value for call param in URI\n  // but also make sure we were the last to connect (to increase\n  // chances that everything is set up properly at both ends)\n  if (queryparams __ queryparams[\'call\'] __ _weWaited) {\n    call();\n  }\n\n}\n\n\n////////////////////////////\n// This next section is for calling and answering\n////////////////////////////\n\n// This creates a data channel and generates the\n// session description for an offer\nfunction call() {\n  dc = pc.createDataChannel(\'chat\');\n  setupDataHandlers();\n  \n  pc.createOffer(gotDescription, doNothing, constraints);\n}\n\n// and this generates it for an answer.\nfunction answer() {\n  pc.createAnswer(gotDescription, doNothing, constraints);\n}\n\n// In either case, once we get the session description we tell\n// our browser to use it as our local description and then send\n// it to the other browser.  It is the setting of the local\n// description that allows the browser to send media and prepare\n// to receive from the other side.\nfunction gotDescription(localDesc) {\n  pc.setLocalDescription(localDesc);\n  send(localDesc);\n}\n\n\n////////////////////////////////////\n// This section is for changing the UI based on application\n// progress.\n////////////////////////////////////\n\n// This function hides, displays, and fills various UI elements\n// to give the user some idea of how the browser is progressing\n// at setting up the signaling channel, getting local media,\n// creating the peer connection, and actually connecting\n// media (calling).\nfunction setStatus(str) {\n  var statuslineE = document.getElementById("statusline"),\n      statusE = document.getElementById("status"),\n      sendE = document.getElementById("send"),\n      connectE = document.getElementById("connect"),\n      callE = document.getElementById("call"),\n      scMessageE = document.getElementById("scMessage");\n      gameE = document.getElementById("game");\n      \n  switch (str) {\n    case \'Waiting\':\n      statuslineE.style.display = "inline";\n      statusE.innerHTML =\n        "Waiting for peer signaling connection";\n      sendE.style.display = "none";\n      connectE.style.display = "none";\n      break;\n    case \'Connected\':\n      statuslineE.style.display = "inline";\n      statusE.innerHTML =\n        "Peer signaling connected, waiting for local media";\n      sendE.style.display = "inline";\n      connectE.style.display = "none";\n      scMessageE.style.display = "inline-block";\n      break;\n    case \'Ready for call\':\n      statusE.innerHTML = "Ready for call";\n      callE.style.display = "inline";\n      break;\n    case \'On call\':\n      statusE.innerHTML = "On call";\n      callE.style.display = "none";\n      gameE.style.display = "inline";\n      break;\n    default:\n  }\n}\n\nfunction getMouseCoords(e) {\n    var x = e.clientX;\n    var y = e.clientY;\n    var coords = {"x":x, "y":y};    \n    \n    displayCoords(coords, "#FF0000");\t// display dot in red    \n}\n\nfunction displayCoords(coords, color) {\n//\tconsole.info(coords);\n\tctx.fillStyle = color;  \n\tctx.fillRect(coords.x,coords.y,3,3);\n}\n\nfunction game() {\n    gameStart();  \n}\n\nfunction gameStart() {\n    canvasE = document.getElementById("canvas");\n    canvasE.style.display = "inline";\n    console.log("Game Started_");\n    ctx.fillText("Draw Here_", 10, 10);\n}\n\n_/script_\n\n_div id="setup"_\n\n  _canvas id="canvas" width="300" height="300" onmousemove="getMouseCoords(event)" \n  \t\t\tborder="2" style="display:none"_ \n  _/canvas_\n\n  _p_WebRTC Book Demo with Game_/p_\n  _p_Key:\n    _input type="text" name="key" id="key"\n           onkeyup="if (event.keyCode == 13) {\n                      connect(); return false;}"/_\n    _button id="connect" onclick="connect()"_Connect_/button_\n    _span id="statusline" style="display:none"_Status:\n      _span id="status"_Disconnected_/span_\n    _/span_\n    _button id="call" style="display:none"\n            onclick = "call()"_Call_/button_\n    _button id="game" style="display:none"\n            onclick = "game()"_Game_/button_        \n  _/p_\n_/div_\n\n_div id="scMessage" style="float:right;display:none"_\n  _p_Signaling channel message:\n    _input type="text" width="100_" name="message" id="message"\n           onkeyup="if (event.keyCode == 13) {\n                      send(); return false;}"/_\n    _button id="send" style="display:none"\n            onclick="send()"_Send_/button_\n  _/p_\n\n  _p_Response:  _span id="response"__/span__/p_\n_/div_\n\n_br/_\n\n_div style="width:30_;vertical-align:top"_\n  _div_\n    _video id="myVideo" autoplay="autoplay" controls\n           muted="true"/_\n  _/div_\n  _p__b_Outgoing Messages_/b_\n     _br/_\n     _textarea id="outmessages" rows="100"\n               style="width:100_"__/textarea_\n  _/p_\n_/div_\n\n_div style="width:30_;vertical-align:top"_\n  _textarea id="chatbox" rows="10" style="width:100_"__/textarea_\n  _p style="width:100_"__b_Real-time:_/b_\n    _textarea id="rtt" rows="2" style="width:100_"__/textarea_\n  _/p_\n  _p style="width:100_"__b_Chat message:_/b_\n    _input type="text" style="width:100_" name="chat" id="chat"\n           onkeyup="sendRtt();\n                    if (event.keyCode == 13) {\n                      sendChat(); return false;}"/_\n  _/p_\n\n\n_/div_\n\n_div style="width:30_;vertical-align:top"_\n  _div_\n    _video id="yourVideo" autoplay="autoplay" controls /_\n  _/div_\n  _p__b_Incoming Messages_/b_\n     _br/_\n     _textarea id="inmessages" rows="100"\n               style="width:100_"__/textarea_\n  _/p_\n_/div_\n\n\n\n\n\n_/body_\n_/html_\n', 'url1': '', 'submit': 'Generate diff', 'url2': '', '--newcolour': 'green'} --></body></html>